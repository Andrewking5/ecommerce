<!-- 80cce32b-8b54-4acc-8315-6cea4c535467 51cc896d-9ac7-442d-af79-96a4a4e3a3f4 -->
# 修复所有路由和导航链接的语言前缀问题

## 完整问题分析

### 核心问题

根据规范文档（E_COMMERCE_SPECIFICATION.md 第 790-806 行），所有导航必须使用 `useLocalizedNavigate` hook 来处理语言前缀。但当前代码中大量组件直接使用 `Link` 的 `to` 属性，导致非英文语言下路由不匹配，内容消失。

### 详细问题清单

#### 1. Layout 组件（21 个问题）

- **Header.tsx**: 11 个 Link 使用绝对路径
- Logo: `to="/"`
- 导航: `to="/products"`, `to="/about"`, `to="/contact"` (桌面和移动端各 3 个)
- 购物车: `to="/cart"`
- 管理后台: `to="/admin"`
- 用户资料: `to="/user/profile"`
- 认证: `to="/auth/login"`, `to="/auth/register"` (认证路由不需要前缀，但需要确认)
- **Footer.tsx**: 10 个 Link 使用绝对路径
- Quick Links: `/products`, `/about`, `/contact`
- Customer Service: `/help`, `/shipping`, `/returns`
- Legal: `/privacy`, `/terms`, `/cookies`
- **AdminLayout.tsx**: `buildPath('')` 会生成双斜杠 `//`，需要修复

#### 2. 页面组件（8 个问题）

- **ProductCard.tsx**: `Link to={/products/${product.id}}` 
- **ProductDetail.tsx**: 2 个 `Link to="/products"`
- **Cart.tsx**: 2 个 `Link to="/products"`
- **Orders.tsx**: 1 个 `Link to="/products"`
- **OrderDetail.tsx**: 2 个 `Link to="/user/orders"`
- **NotFound.tsx**: 1 个 `Link to="/"`

#### 3. 管理后台组件（7 个问题）

- **AdminDashboard.tsx**: 3 个 `Link to="/admin/products"`, `/admin/orders`, `/admin/users`
- **Breadcrumb.tsx**: 1 个 `Link to="/admin"`
- **AdminProducts.tsx**: 1 个 `<Navigate to="/" replace />`
- **AdminCategories.tsx**: 1 个 `<Navigate to="/" replace />`
- **AdminOrders.tsx**: 1 个 `<Navigate to="/" replace />`
- **AdminUsers.tsx**: 1 个 `<Navigate to="/" replace />`

#### 4. 已正确使用的组件

- **Home.tsx**: 已使用 `useLocalizedNavigate` ✓
- **Login.tsx, Register.tsx**: 已使用 `useLocalizedNavigate` ✓
- **LanguageSwitcher.tsx**: 已正确处理语言切换 ✓

## 修复方案

### 1. 创建 LocalizedLink 组件

创建 `frontend/src/components/common/LocalizedLink.tsx`，自动处理语言前缀：

- 接收相对路径（如 `products`, `admin`）
- 根据当前语言自动添加前缀
- 默认语言（en）不添加前缀

### 2. 修复 AdminLayout 的 buildPath 函数

- 修复 `buildPath('')` 生成双斜杠的问题
- 确保空路径返回正确的根路径

### 3. 更新 Header 组件

- 将所有 `Link` 的 `to` 属性改为使用 `useLocalizedNavigate` 或 `LocalizedLink`
- 更新所有导航链接：`/products`, `/about`, `/contact`, `/cart`, `/admin`, `/user/profile`

### 4. 更新 Footer 组件

- 将所有 `Link` 改为使用 `LocalizedLink` 或 `useLocalizedNavigate`
- 更新所有链接：`/products`, `/about`, `/contact`, `/help`, `/shipping`, `/returns`, `/privacy`, `/terms`, `/cookies`

### 5. 更新 ProductCard 组件

- 将商品详情链接改为使用 `useLocalizedNavigate` 或 `LocalizedLink`
- 路径：`/products/${product.id}`

### 6. 检查其他页面组件

- 检查所有页面组件中的导航链接
- 确保所有 `Link` 和 `navigate` 调用都正确处理语言前缀

### 7. 测试验证

- 测试所有语言的导航链接
- 验证路由匹配正确
- 确保没有双斜杠问题

## 文件清单

需要修改的文件：

1. `frontend/src/components/common/LocalizedLink.tsx` (新建)
2. `frontend/src/components/layout/AdminLayout.tsx` (修复 buildPath)
3. `frontend/src/components/layout/Header.tsx` (更新所有 Link)
4. `frontend/src/components/layout/Footer.tsx` (更新所有 Link)
5. `frontend/src/components/product/ProductCard.tsx` (更新商品链接)
6. 其他可能使用 Link 的组件（如需要）

## 实施步骤

1. 创建 LocalizedLink 组件
2. 修复 AdminLayout 的 buildPath 函数
3. 逐个更新 Header、Footer、ProductCard 组件
4. 检查并更新其他相关组件
5. 测试所有语言的路由和导航

### To-dos

- [ ] 安装前端 i18n 依赖包（react-i18next, i18next, i18next-browser-languagedetector）
- [ ] 在 User 模型中添加 preferredLanguage 字段并创建迁移